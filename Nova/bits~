(Prim A a) `and` (Prim B b) = intermediate A
                              (return (and #a #b))

(Prim A a) `or` (Prim B b)  = intermediate A
                              (return (or #a #b))

(Prim A a) `xor` (Prim B b) = intermediate A
                              (return (xor #a #b))

(Prim A a) `shiftl` (Int b) = intermediate A
                              (return (sl #a #b))

(Prim A a) `shiftr` (Int b) = intermediate A
                              (return (srl #a #b))

(Prim A a) `shiftar` (Int b) = intermediate A
                               (return (sra #a #b))

(Prim A a) `set` (Int b) where 0 <= b < bitsize a = intermediate A
                                                    (return (or #a (exp 2 #b)))

(Prim A a) `clear` (Int b) where 0 <= b < bitsize a = intermediate A
                                                      (return (and #a (not (exp 2 #b))))

(Ref (Prim A) a) `decode` (Int b) where 0 <= < bitsize a
  (dec b) = intermediate (A,A)
            (and #a (sub (exp 2 b) 1)),
            (sr #a #b)
  a := b >> dec

`not` (Prim A a) = intermediate A
                   (not #a)
(Prim A c) `decode` (Int a) where 0 <= a < bitsize c
  intermediate (Prim A, Prim A)
  (tuple (and #c (sub (exp 2 a) 1))
         (sr #c #a))
