<!DOCTYPE html>
<html>
        <head>
                <title>Stack allocation</title>
                <link rel="stylesheet" href="../Style.css">
        </head>
        <body>
                <p>Stack allocation has been discussed in the chapter on optimizations. However, it is quite an interesting topic so I'll devote a chapter to go more into depth.</p>
                <pre>
                findthea String s
                  l = length s
                  @rec i = 0
                    i     == l  >> void
                    s ! i == 'a >> i
                    rec (i + 1)

                interact = findthea getline
                </pre>
                <p>Here we define two function. 'findthea' and 'interact'. 'interact' simply just makes a syscall, to prompt the user for a line of input, and gives that line to the function 'findthea'. Normally strings are allocated on the heap, as any other object, but because we want Nova to be as fast a language as possible, the compiler is forced to do some thinking before allocating any object. In this case, the compiler would see that the return value of 'getline' is never used outside the scope of 'findthea'. That is, 'findthea' simply doesn't return it. So if we know that the line is never used after the function 'findthea' has returned, why leave the line on the heap for the garbage collector to pick up? Instead, we could just allocate it on the stack space that we allocated for the function 'findthea', and when that function returns, and the stack pointer is adjusted back, then the line is automatically discarded.</p>
                <p>Yes, some thinking to do, and not that easy perhaps to implement, but I think it would be worth it.</p>
        </body>
</html>

